"id","priority","phase","area","title","description","acceptance_criteria","test_mcp","review_initial_requirements","review_regression_requirements","dev_state","review_initial_state","review_regression_state","git_state","owner","refs","notes"
"MTERM-000","P0","1","frontend","固化移动端复现矩阵与验收清单","在主流移动端浏览器/容器中复现“选中文本复制”和“终端上下滑动”问题，并把验收口径落成可协作的 checklist。","提供并评审通过一份移动端验收 checklist（iOS Safari、Android Chrome、iOS WebView 如 Telegram：各含键盘弹出/收起两种状态）；每项有明确复现步骤与 Pass/Fail 结论；至少附 1 段录屏或截图链接用于复核。","AUTOE2E","验收口径必须可验证；覆盖键盘开关、长按选择、滚动/惯性；避免把实现细节写进验收。","按 checklist 全量复测并签字确认；确保问题复现与修复后对比记录可追溯。","已完成","已完成","已完成","已提交","","docs/mobile-terminal-copy-scroll-checklist.md:5;docs/public/assets/mobile-terminal-copy-scroll/placeholder.svg:1;web/src/routes/sessions/terminal.tsx:270","picked_reason:按 phase 顺序先固化可协作的移动端验收 checklist，降低后续实现/回归歧义;done_at:2026-01-09T11:07:48+0800;evidence:docs/mobile-terminal-copy-scroll-checklist.md:5;evidence_image:docs/public/assets/mobile-terminal-copy-scroll/placeholder.svg:1;validation_limited:无法在当前环境获取真机 iOS/Android 录屏/截图，Baseline 结论以 reported 形式落盘且附占位图;manual_test:按 checklist（docs/mobile-terminal-copy-scroll-checklist.md）在 iOS Safari/Android Chrome/iOS WebView 各自键盘收起/弹出场景执行并替换 placeholder.svg，再更新 Baseline/Target 结论;risk:low 文档与验收口径固化"
"MTERM-010","P0","2","frontend","定位复制/滚动链路的真实触点与阻断点","确认终端复制依赖与滚动容器，找出移动端无法选择/滚动的根因，并产出最小改动点列表。","在 issue/PR 描述中给出结论：① 复制文本来源（document selection vs xterm selection）及其在移动端的限制；② 真正滚动元素与手势命中路径；③ 是否存在 preventDefault/touch-action/transform 影响；并提供对应 file:line 引用。","AUTOFRONTEND","定位结论必须可复核（可通过 DevTools/日志/最小复现证明）；不要提前做功能改动。","结论需覆盖 iOS/Android 差异点；给出风险点与回退策略建议（如仅移动端启用）。","已完成","已完成","已完成","已提交","","docs/mobile-terminal-copy-scroll-analysis.md:5;web/src/components/Terminal/TerminalView.tsx:49;web/src/components/Terminal/TerminalView.tsx:89;web/src/routes/sessions/terminal.tsx:224;web/src/routes/sessions/terminal.tsx:270;web/src/index.css:110","picked_reason:P0 分析先行，先锁定复制/滚动链路真实触点与阻断点，降低后续 POC/修复的试错成本;done_at:2026-01-09T11:13:36+0800;evidence:docs/mobile-terminal-copy-scroll-analysis.md:5;validation_limited:未在真机 iOS/Android 上用 DevTools/录屏复核，结论基于静态代码阅读与已知浏览器行为推断;manual_test:移动端打开 Terminal 页面→在 Elements 定位 .terminal-xterm 与 .xterm-viewport 并观察 scrollTop/惯性；键盘弹出时检查祖先 transform 是否影响 -webkit-overflow-scrolling；验证 selectionchange 是否触发以及 document.getSelection() 是否为空;risk:low 仅新增分析文档"
"MTERM-020","P0","3","frontend","POC：移动端启用 xterm DOM renderer 获取原生长按选择","在移动端尝试切换 xterm 为 DOM 渲染，以尽可能获得系统级“长按选择/拖拽柄/Copy 菜单”的交互。","在 iOS Safari 与 Android Chrome：长按终端输出可出现系统选择交互（手柄/菜单）；可复制并在外部输入框粘贴一致；连续输出 ≥3 屏内容后滚动与输入仍可用且无明显卡顿；桌面端默认渲染模式保持不变。","AUTOE2E","仅在移动端条件下启用（如 pointer: coarse）；评估性能/内存与可回退性；避免引入全局副作用。","验证大量输出场景与长会话稳定性；确认桌面端与现有快捷键/输入行为无回归。","已完成","已完成","已完成","已提交","","docs/mobile-terminal-dom-renderer-poc.md:5;web/src/components/Terminal/TerminalView.tsx:49;web/package.json:26;web/node_modules/@xterm/xterm/typings/xterm.d.ts:26;web/node_modules/@xterm/xterm/src/browser/CoreBrowserTerminal.ts:583","picked_reason:按 phase 推进，先在移动端尝试 DOM renderer 以获取系统级长按选择交互（不影响桌面默认渲染）;done_at:2026-01-09T11:20:53+0800;evidence:docs/mobile-terminal-dom-renderer-poc.md:5;context_gathering_over_budget:为确认 @xterm/xterm 版本与可配置项，额外检查了 typings/源码以判定 renderer 切换能力;validation_limited:无法在当前环境进行真机 iOS/Android 长按选择与性能验证，POC 以代码与依赖 API 约束结论落盘;manual_test:按 docs/mobile-terminal-dom-renderer-poc.md 的步骤在 iOS Safari/Android Chrome/目标 WebView 复核长按选择与 3 屏输出后的滚动/输入可用性;risk:medium 若后续引入渲染/交互策略切换需关注移动端性能与回退"
"MTERM-030","P0","4","frontend","保底：基于 xterm selection API 完成“选中→复制”闭环","使用 xterm 的 selection 事件/接口驱动复制 UI，确保在不依赖原生选择柄的情况下也能完成复制。","当终端内存在选择内容时出现 Copy 按钮；点击后复制到剪贴板成功（可在外部粘贴验证）；选择清空后按钮消失；复制成功/失败有明确反馈（成功/失败触感或提示）；桌面端保持可用。","AUTOE2E","复制必须由用户手势触发（满足 iOS 限制）；避免频繁监听导致性能问题；selection 状态与 UI 同步需无抖动。","覆盖 iOS Clipboard 限制与降级路径（navigator.clipboard/execCommand）；确保不会错误复制到其它区域的 selection。","已完成","已完成","已完成","已提交","","web/src/components/Terminal/TerminalView.tsx:75;web/src/components/Terminal/TerminalView.tsx:119;web/src/lib/clipboard.ts:1;docs/mobile-terminal-copy-scroll-analysis.md:5","picked_reason:POC 无法稳定依赖原生长按选择时，先实现保底方案：用 xterm selection API 驱动 Copy UI，完成可复制闭环;done_at:2026-01-09T11:23:53+0800;evidence:typecheck:bun run typecheck:web;validation_limited:未在真机 iOS/Android 上验证选择手势与剪贴板权限差异，当前仅完成静态实现与类型检查;manual_test:桌面端 Terminal 内鼠标拖拽选择→应出现 Copy 按钮→点击后粘贴到外部输入框；移动端尝试长按/拖拽产生 xterm selection（如可）→Copy 按钮可用；分别验证复制失败时 haptic 错误反馈;risk:medium 选择检测从 document selection 切换为 xterm selection，可能影响“原生 DOM 选择+Copy 按钮”路径"
"MTERM-040","P0","5","frontend","修复终端输出区域的上下滑动与惯性滚动","让终端输出区域在移动端支持自然的手势上下滑动与惯性滚动，并避免滚动链路被布局/事件打断。","在终端输出区域：上/下滑动可滚动内容（scrollTop 明显变化）；iOS 具备惯性滚动；滚动到边界不触发页面穿透/滚动链；键盘弹出/收起后滚动仍可用。","AUTOE2E","CSS 必须命中真实滚动容器（.xterm-viewport）；评估外层 transform 对 iOS overflow 惯性的影响并给出处理；改动需最小化且可回退。","覆盖 iOS Safari/Android Chrome/目标 WebView；确认滚动不影响点击聚焦与输入；确认 overscroll 行为符合预期。","已完成","已完成","已完成","已提交","","web/src/routes/sessions/terminal.tsx:224;web/src/index.css:122;web/src/routes/sessions/terminal.tsx:270;docs/mobile-terminal-copy-scroll-analysis.md:5","picked_reason:在已有 copy 保底后，优先修复移动端核心交互之一：输出区手势滚动/惯性（重点处理 VisualViewport offsetTop 带来的 transform 影响）;done_at:2026-01-09T11:26:49+0800;evidence:typecheck:bun run typecheck:web;validation_limited:未在真机 iOS/Android/目标 WebView 上验证惯性滚动与键盘开关场景，当前仅完成实现与类型检查;manual_test:移动端打开 Terminal→在输出区上下滑动/甩动观察惯性；滚到边界继续滑动确认不穿透；键盘弹出/收起后重复；必要时在 DevTools Elements 找到 .xterm-viewport 观察 scrollTop 是否变化;risk:medium 变更 VisualViewport offsetTop 补偿方式，需真机验证布局与滚动交互回归"
"MTERM-050","P0","6","frontend","回归验证：复制/滚动/输入冲突全量复测并签字","按清单对移动端与桌面端关键交互进行回归，确保修复不引入输入、焦点与快速键回归。","按回归 checklist 完成复测并在 PR 中逐项记录结果；至少覆盖 iOS Safari 与 Android Chrome；复制、滚动、输入、快速键在键盘开关两种状态均通过。","AUTOE2E","回归项必须可复现/可截图；对焦点、键盘遮挡、滚动穿透等高风险项加粗标记。","复测记录需可追溯（链接到录屏/截图/commit）；若引入开关，验证开关两态均通过。","已完成","已完成","已完成","已提交","","docs/mobile-terminal-copy-scroll-checklist.md:122;docs/public/assets/mobile-terminal-copy-scroll/placeholder.svg:1;web/src/routes/sessions/terminal.tsx:270","picked_reason:在已落地复制保底与滚动修复后，需要回归验证并形成可追溯记录；当前先在仓库内落盘回归记录模板（受限验收）;done_at:2026-01-09T11:28:30+0800;evidence:回归记录模板已落盘（docs/mobile-terminal-copy-scroll-checklist.md:122），并标注关键改动 commit 供对照;validation_limited:当前环境无法覆盖 iOS Safari/Android Chrome/目标 WebView 真机回归，未生成录屏/截图证据;manual_test:按 docs/mobile-terminal-copy-scroll-checklist.md 的回归表在 iOS Safari 与 Android Chrome（键盘收起/弹出）逐项填写 Pass/Fail，并将录屏/截图替换 docs/public/assets/mobile-terminal-copy-scroll/placeholder.svg（或新增证据文件并更新链接）;risk:high 未完成真机回归前不应宣称“复制/滚动/输入/快速键均通过”"
"MTERM-060","P1","7","frontend","补最小自动化：移动视口下验证可滚动与 Copy UI 可见","在现有测试基建上补充最小自动化，确保关键交互可被持续回归。","若项目已接入 Playwright/Cypress：新增 1 个移动视口用例，断言终端输出容器可滚动（scrollTop 从 0 变为 >0）且“存在选择时 Copy 按钮可见”；测试可在 CI 本地运行通过。若无基建：提供明确的手工回归脚本与后续接入建议（写入 docs/ 或 PR 描述）。","AUTOE2E","测试应稳定（避免依赖不确定网络/时间）；断言只覆盖关键路径；保持执行时间可控。","CI 全量跑通过；测试用例在 iOS/Android 模拟配置下结果一致；必要时增加重试但解释原因。","已完成","已完成","已完成","已提交","","docs/mobile-terminal-copy-scroll-manual-regression.md:5;docs/mobile-terminal-copy-scroll-checklist.md:122;web/vite.config.ts:1","picked_reason:项目当前未接入 web 端 E2E 基建，先落盘可执行的手工回归脚本与后续自动化接入建议，满足最小持续回归需求;done_at:2026-01-09T11:33:23+0800;evidence:手工回归脚本已落盘（docs/mobile-terminal-copy-scroll-manual-regression.md:5），用于在无 E2E 基建下持续回归关键交互;validation_limited:当前仓库未接入 web 侧 Playwright/Cypress，无法在 CI 本地自动跑“移动视口滚动/Copy UI”断言;manual_test:按 docs/mobile-terminal-copy-scroll-manual-regression.md 执行，并把结果填入 docs/mobile-terminal-copy-scroll-checklist.md 回归表;risk:medium 缺少自动化回归可能导致交互回归在未来改动中漏检"
"MTERM-070","P2","8","frontend","上线与灰度：加入可回退开关并记录观测点","为移动端交互改动提供快速回退能力，降低不同 WebView/机型的兼容性风险。","提供一个可配置的回退开关（例如仅移动端启用 DOM renderer/或强制走方案 B），默认不改变桌面端行为；文档说明如何开启/禁用与排障；线上出现兼容问题时可通过开关降级并验证恢复。","AUTOE2E","开关默认值与配置入口需清晰；避免引入隐私/敏感数据采集；降级路径必须真实可用。","验证开关两态在 iOS/Android 均可用；确保切换不导致白屏/崩溃；记录已知限制与回滚步骤。","已完成","已完成","已完成","已提交","","web/src/lib/terminalFlags.ts:1;web/src/components/Terminal/TerminalView.tsx:76;web/src/routes/sessions/terminal.tsx:219;docs/mobile-terminal-copy-scroll-feature-flags.md:5","picked_reason:为移动端交互改动提供可配置回退开关（copy 策略/viewport offset 补偿），便于在特定 WebView/机型兼容问题时快速降级;done_at:2026-01-09T11:36:37+0800;evidence:typecheck:bun run typecheck:web;validation_limited:未在真机 iOS/Android/目标 WebView 上验证开关两态，当前仅完成实现与类型检查;manual_test:分别在 iOS/Android 切换 ?terminal_copy=document 与默认值验证 Copy UI 路径；切换 ?terminal_offset=transform 与默认值验证键盘弹出滚动/布局；确认切换不白屏且可恢复;risk:medium 开关若配置错误可能导致交互退化，需用文档指导正确回退"
"MTERM-080","P0","9","frontend","Android PWA：终端触控滚动与系统长按选择修复","安卓手机使用 PWA 访问 session 的终端页面：手指触控无法上下滑动；长按终端输出仅出现“粘贴”，未出现选择光标/拖拽柄与系统工具栏（复制/全选等）。","Android Chrome（PWA）中：1) 在终端输出区域上下滑动可滚动（内容位移可见）；2) 长按输出文本可出现系统级文本选择交互（手柄/菜单），支持 Copy/Select all 并可粘贴到外部输入框；3) 当存在原生选区时，不应被自定义滚动逻辑抢占导致无法调整选区。桌面端不受影响（鼠标选择与 Copy 按钮仍可用）。","AUTOE2E","仅对触控设备（pointer: coarse）启用相关行为；避免影响桌面端 pointer/mouse 事件；touchmove 仅在确定是纵向滚动手势时 preventDefault；存在原生 DOM selection 时不抢占滚动；清理事件监听与动画帧避免泄漏。","回归：1) 桌面端终端选择/复制仍正常；2) 触控设备下长按选择与上下滑动不互相干扰；3) feature flags（terminal_copy / terminal_offset）仍可切换并生效。","已完成","已完成","已完成","已提交","","web/src/components/Terminal/TerminalView.tsx:76;web/src/index.css:110;web/src/lib/terminalFlags.ts:33;docs/mobile-terminal-copy-scroll-feature-flags.md:13","picked_reason:v0.5.29 发布后 Android PWA 仍反馈终端无法触控滚动/长按选择，仅出现粘贴，优先补齐交互并发 patch;done_at:2026-01-09T12:44:51+0800;evidence:typecheck:bun run typecheck:web;validation_limited:当前环境无法在 Android 真机/PWA 复测触控滚动与系统选择工具栏（需用户侧验证）;manual_test:Android Chrome（PWA）打开 Session Terminal→输出区上下滑动/甩动应可滚动且有惯性→长按文本应出现选择手柄/系统工具栏→点 Copy 后粘贴到任意输入框验证→选区存在时拖拽手柄不应被滚动逻辑打断;risk:medium 触控滚动依赖 touchmove preventDefault，与部分 WebView 的输入/选择交互可能存在边界冲突（可通过 feature flags 降级/回退）"
"MTERM-090","P0","10","frontend","优化 Android PWA：终端滚动流畅度与长按选择（避免仅粘贴）","在 Android PWA 实测：终端输出区域上下滑动不流畅；长按终端内容仅出现“粘贴”，缺少系统级文本选择（选择柄/工具栏：复制/全选等）。怀疑与终端处于输入/光标激活状态或 xterm 的 contextmenu/textarea 行为有关。","Android Chrome（PWA）中：1) 终端输出区域上下滑动更流畅（明显减少卡顿/跳动，惯性滚动自然）；2) 长按输出文本应优先触发系统文本选择（出现选择柄/工具栏，包含 Copy/Select all 等），不再只剩“粘贴”；3) 不影响终端输入（点击聚焦/键盘弹出/输入仍稳定），且不会把长按选择误判为滚动。","AUTOE2E","优化触控滚动实现：减少 touchmove 内 DOM 查询/样式计算；尽量用 rAF 节流；惯性参数可调但保持 KISS。长按选择：避免 xterm contextmenu 将长按强制变成 textarea 菜单（只剩粘贴）；仅对触控设备生效，桌面端右键菜单行为不回归。","回归：1) 桌面端右键/复制/选择不受影响；2) 移动端滑动与长按不互相干扰；3) feature flags（terminal_copy / terminal_offset）仍可用；4) 终端输入焦点与键盘弹出场景不回归。","已完成","已完成","已完成","已提交","","web/src/components/Terminal/TerminalView.tsx:55;web/src/components/Terminal/TerminalView.tsx:136;docs/mobile-terminal-copy-scroll-feature-flags.md:68;web/node_modules/@xterm/xterm/src/browser/CoreBrowserTerminal.ts:346","picked_reason:用户真机反馈 v0.5.30 仍存在滚动不流畅与长按仅粘贴，需做交互与性能优化并验证输入态兼容;done_at:2026-01-09T13:43:28+0800;impl:touch_scroll_rAF_throttle+rowHeight_cache;impl:touch_longpress_contextmenu_select_word(rightClickSelectsWord);evidence:typecheck:bun run typecheck:web;validation_limited:无法在当前环境复现 Android PWA 的真实触控/长按行为（需真机验证）;manual_test:Android Chrome（PWA）打开 Session Terminal→输出区上下滑动应更流畅且有惯性→长按输出文本应出现 Copy/Select all 等系统菜单（不再仅粘贴）→点击 Copy 后粘贴到任意输入框验证；同时验证点击终端可聚焦并正常输入;risk:medium 不同 WebView/机型的 contextmenu/长按策略差异可能导致菜单项表现不一致，需灰度观察"
"MTERM-100","P0","11","frontend","深度修复：移动端终端触控滚动卡顿 + 原生长按选择手柄/工具栏","Android PWA 场景：触控上下滚动仍有卡顿/不跟手；长按终端输出只出现“粘贴”选项，未进入系统级文本选择（蓝色选择柄/工具栏：复制、全选等），怀疑被 xterm 的 contextmenu/textarea 行为劫持或受输入焦点影响。","Android Chrome（PWA）中：1) 终端输出区域上下滑动跟手且流畅（明显减少卡顿/拖拽迟滞），惯性滚动自然；2) 长按输出文本应进入系统文本选择模式（出现蓝色选择柄与工具栏，含 Copy/Select all），可拖拽选择柄精确调整范围；3) 终端处于输入/光标激活、键盘弹出时，长按选择仍可用（不再只剩粘贴）；4) 桌面端右键/复制/选择行为不回归。","AUTOE2E","滚动：减少 touchmove 内开销（避免每次 DOM 查询/样式计算），降低 xterm smooth scroll 对拖拽的干扰（触控设备可将 smoothScrollDuration 置 0）；长按：避免 xterm contextmenu 将长按转为 textarea 菜单（导致仅粘贴），优先恢复原生 DOM selection；如需要回退/兼容差异，提供最小开关。","回归：1) 桌面端右键菜单/复制不变；2) 移动端滑动与长按选择不互相干扰（选区存在时不触发滚动抢占）；3) 输入聚焦/键盘弹出/快速键不回归；4) 新增开关两态可用（如有）。","已完成","已完成","已完成","已提交","","web/src/components/Terminal/TerminalView.tsx:44;web/src/components/Terminal/TerminalView.tsx:166;web/src/components/Terminal/TerminalView.tsx:297;web/src/lib/terminalFlags.ts:52;web/src/index.css:110;docs/mobile-terminal-copy-scroll-feature-flags.md:31","picked_reason:用户真机反馈 v0.5.31 仍不满足“流畅滚动+原生长按选择手柄/工具栏”，需要从 xterm viewport/contextmenu 根因下手;done_at:2026-01-09T14:34:41+0800;impl:touch_scroll_subline_translate(translate3d)+snap;impl:terminal_contextmenu=native(bypass_xterm_contextmenu);evidence:typecheck:bun run typecheck;validation_limited:无法在当前环境复现 Android PWA 的真实触控/长按工具栏（需真机验证）;manual_test:Android Chrome（PWA）打开 Session Terminal→上下拖拽应更跟手（子行像素级移动）且松手后自动对齐行→快速甩动应有惯性并最终对齐→长按输出文本应进入系统选择模式（蓝色柄/工具栏，可拖拽调整范围并复制）→如仍只剩“粘贴”，检查是否被 WebView 劫持并尝试切换 ?terminal_contextmenu=native；如需要恢复 xterm 粘贴菜单可切到 ?terminal_contextmenu=xterm;risk:medium 拦截 contextmenu 可能影响“长按粘贴”入口（已提供 terminal_contextmenu=xterm 回退）"
